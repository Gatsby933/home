<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <!-- 基础信息 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="主页">
    <meta name="keywords" content="导航,主页">
    <meta name="author" content="涵の宇宙">
    <title>欢迎来到我的主页</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="./images/草莓.svg">
    <style>
        .social-link:hover {
            background: rgba(255, 255, 255, 0.3) !important;
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .card {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* 优化动画性能 */
        .social-link, .btn, .card {
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
            transition: all 0.2s ease;
        }
        
        /* 减少重绘和回流 */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* 优化滚动性能 */
        .modal-body {
            -webkit-overflow-scrolling: touch;
        }
        
        /* 移动端滚动优化 */
        @media (max-width: 767.98px) {
            html, body {
                scroll-behavior: smooth;
            }
            
            .container {
                overflow-y: auto;
            }
        }
        
        /* 复制成功提示动画 */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* 滚动条美化 */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(128, 128, 128, 0.8), rgba(64, 64, 64, 0.8));
            border-radius: 4px;
            backdrop-filter: blur(5px);
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(160, 160, 160, 0.9), rgba(80, 80, 80, 0.9));
        }
        
        /* Firefox滚动条 */
        .modal-body {
            scrollbar-width: thin;
            scrollbar-color: rgba(128, 128, 128, 0.8) rgba(255, 255, 255, 0.1);
        }

        /* 移动端优化 */
        @media (max-width: 767.98px) {
            body {
                overflow-x: hidden !important;
                background-attachment: scroll !important;
                min-height: 100vh !important;
            }
            
            main.container {
                min-height: auto !important;
                padding: 20px 15px 100px 15px !important;
                transform: none !important;
                display: flex !important;
                align-items: flex-start !important;
                justify-content: center !important;
            }
            
            .row.w-100.text-center {
                flex-direction: column !important;
                transform: none !important;
                max-width: 100% !important;
                margin: 0 !important;
                gap: 20px !important;
            }
            
            .col-md-4, .col-md-5 {
                max-width: 100% !important;
                flex: 0 0 100% !important;
                margin: 0 !important;
                padding: 0 10px !important;
            }
            
            .col-md-4 {
                margin-bottom: 0 !important;
                order: 1 !important;
            }
            
            .col-md-5 {
                order: 2 !important;
            }
            
            /* 头像和姓名区域 */
            .col-md-4 img.rounded-circle {
                width: 100px !important;
                height: 100px !important;
                margin-bottom: 15px !important;
            }
            
            .col-md-4 h5 {
                font-size: 1.5rem !important;
                margin-bottom: 15px !important;
            }
            
            /* 卡片样式 */
            .card.w-75, .card.w-100 {
                width: 100% !important;
                min-width: 0 !important;
                margin-bottom: 15px !important;
            }
            
            .card-body {
                padding: 15px !important;
            }
            
            /* 天气时间模块 */
            .col-md-5 .card.w-75 {
                transform: none !important;
                margin-bottom: 20px !important;
            }
            
            .col-md-5 .card-body {
                min-height: 100px !important;
            }
            
            #date {
                font-size: 1.2rem !important;
                margin-bottom: 8px !important;
            }
            
            #time {
                font-size: 2rem !important;
                margin-bottom: 8px !important;
            }
            
            #weather {
                font-size: 1rem !important;
            }
            
            /* 按钮区域 */
            .row.w-85 {
                width: 100% !important;
                margin: 0 !important;
            }
            
            .col-4 {
                padding: 0 5px !important;
            }
            
            .btn {
                height: 50px !important;
                font-size: 14px !important;
                border-radius: 8px !important;
            }
            
            .btn img {
                width: 18px !important;
                height: 18px !important;
                margin-right: 8px !important;
            }
            
            /* 社交媒体链接 */
            .d-flex.justify-content-center.align-items-center.mt-3 {
                flex-wrap: wrap !important;
                gap: 12px !important;
                margin-top: 15px !important;
            }
            
            .social-link {
                width: 35px !important;
                height: 35px !important;
            }
            
            .social-link img {
                width: 18px !important;
                height: 18px !important;
            }
            
            /* 更新日志 */
            .update-log .update-item {
                padding: 8px 0 !important;
            }
            
            .update-title {
                font-size: 0.75rem !important;
            }
            
            .update-time {
                font-size: 0.65rem !important;
            }
            
            /* 底部版权 */
            .footer-fixed {
                position: relative !important;
                padding: 20px 0 10px 0 !important;
                margin-top: 20px !important;
                bottom: auto !important;
            }
            
            .footer-fixed > div {
                font-size: 0.8rem !important;
                padding: 6px 15px !important;
            }
        }
        
        /* 超小屏幕优化 */
        @media (max-width: 480px) {
            main.container {
                padding: 15px 10px !important;
            }
            
            .col-md-4, .col-md-5 {
                padding: 0 5px !important;
            }
            
            .col-md-4 img.rounded-circle {
                width: 90px !important;
                height: 90px !important;
            }
            
            .col-md-4 h5 {
                font-size: 1.3rem !important;
            }
            
            .card-body {
                padding: 12px !important;
            }
            
            #date {
                font-size: 1.1rem !important;
            }
            
            #time {
                font-size: 1.8rem !important;
            }
            
            .btn {
                height: 45px !important;
                font-size: 13px !important;
            }
            
            .btn img {
                width: 16px !important;
                height: 16px !important;
                margin-right: 6px !important;
            }
            
            .social-link {
                width: 32px !important;
                height: 32px !important;
            }
            
            .social-link img {
                width: 16px !important;
                height: 16px !important;
            }
        }
        
        /* 背景图片响应式优化 */
        @media (max-width: 767.98px) {
            body {
                background-attachment: scroll !important;
                background-size: cover !important;
                background-position: center center !important;
            }
        }
        
        @media (min-width: 768px) {
            body {
                background-attachment: fixed !important;
                background-size: cover !important;
                background-position: center center !important;
            }
        }
        
        /* 移动端特殊优化 */
        @media (max-width: 767.98px) {
            /* 确保内容不会溢出 */
            .container {
                max-width: 100% !important;
                overflow-x: hidden !important;
            }
            
            /* 优化卡片阴影和边框 */
            .card {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
                border-radius: 12px !important;
            }
            
            /* 优化按钮悬停效果 */
            .btn:hover {
                transform: scale(1.02) !important;
            }
            
            /* 优化社交媒体链接悬停效果 */
            .social-link:hover {
                transform: scale(1.03) !important;
            }
            
            /* 移动端性能优化 */
            .social-link, .btn, .card {
                will-change: auto !important;
                transform: none !important;
            }
            
            .social-link:hover, .btn:hover {
                transform: scale(1.02) !important;
            }
            
            /* 确保模态框在移动端正常显示 */
            .modal-dialog {
                margin: 10px !important;
            }
        }
    </style>
</head>

<body style="background-image: url('./images/home.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed; overflow-x: hidden;">
    <!-- 主体内容 -->
    <main class="container d-flex align-items-center justify-content-center" style="min-height: 85vh; padding: 20px 0; transform: translate(10px, 20px);">
        <div class="row w-100 text-center" style="transform: translateX(12%); max-width: 1000px;">
            <!-- 左侧个人信息 -->
            <div class="col-md-4 d-flex flex-column align-items-center" style="margin-top: 60px;" id="profile-section">
                <img src="https://cloud-image-host.oss-cn-beijing.aliyuncs.com/wo.jpg" alt="头像"
                    class="rounded-circle shadow mb-3" style="width: 120px; height: 120px; border: 3px solid white;">
                <h5 class="mb-3" style="font-size: 1.8rem; font-weight: bold; font-family: 'Microsoft YaHei', sans-serif; color: white;">@王映寒</h5>
                <div class="card w-75"
                    style="background: rgba(50, 50, 50, 0.8); font-size: 1.2rem; backdrop-filter: blur(10px); color: white; font-family: 'Microsoft YaHei', sans-serif;">
                    <div class="card-body text-center">
                        <p class="card-text">技术，思想，表达。</p>
                    </div>
                </div>
                
                <!-- 外部链接图标 -->
                <div class="mt-3 d-flex justify-content-center align-items-center" style="gap: 15px;">
                    <a href="https://github.com/Gatsby933" target="_blank" class="social-link" title="GitHub主页" style="display: inline-block; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; text-decoration: none;">
                        <img src="./images/github.svg" alt="GitHub" style="width: 20px; height: 20px;">
                    </a>
                    <a href="https://weibo.com/u/7798052809" target="_blank" class="social-link" title="微博主页" style="display: inline-block; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; text-decoration: none;">
                        <img src="./images/新浪微博.svg" alt="微博" style="width: 20px; height: 20px;">
                    </a>
                    <a href="https://v.douyin.com/_rSL0zBfxbw/ 9@5.com :8pm" target="_blank" class="social-link" title="抖音主页" style="display: inline-block; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; text-decoration: none;">
                        <img src="./images/抖音 (1).svg" alt="抖音" style="width: 20px; height: 20px;">
                    </a>
                    <a href="#" class="social-link" id="emailBtn" title="联系邮箱：nufewyh2023@163.com" style="display: inline-block; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; text-decoration: none;">
                        <img src="./images/邮箱.svg" alt="邮箱" style="width: 20px; height: 20px;">
                    </a>
                    <a href="#" class="social-link" id="wechatBtn" title="微信号：Gatsby933" style="display: inline-block; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; text-decoration: none;">
                        <img src="./images/微信 (1).svg" alt="微信" style="width: 20px; height: 20px;">
                    </a>
                </div>
            </div>

            <!-- 右侧模块 -->
            <div class="col-md-5 d-flex flex-column align-items-center" style="margin-left: 50px;">
                <!-- 天气时间模块 -->
                <div class="card w-75 mb-3"
                    style="background: rgba(50, 50, 50, 0.8); font-size: 1.2rem; backdrop-filter: blur(10px); color: white; font-family: 'Microsoft YaHei', sans-serif; transform: translate(5px, -10px);">
                    <div class="card-body text-center d-flex flex-column justify-content-center align-items-center" style="min-height: 120px;">
                        <p id="date" style="font-size: 1.5rem; margin-bottom: 10px; text-align: center; width: 100%;">2025年7月27日</p>
                        <p id="time" style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px; text-align: center; width: 100%;">加载中...</p>
                        <div class="d-flex align-items-center justify-content-center" style="width: 100%;">
                            <p id="weather" style="font-size: 1.2rem; margin-bottom: 0; text-align: center;">北京 天气：晴 25°C</p>
                        </div>
                    </div>
                </div>
                <!-- 按钮 -->
                <div class="row w-85">
                    <div class="col-4 mb-3">
                        <a href="#" class="btn w-100 shadow d-flex align-items-center justify-content-center"
                            style="background: rgba(50, 50, 50, 0.8); height: 60px; font-size: 16px; color: white; font-family: 'Microsoft YaHei', sans-serif;">
                            <img src="./images/博客园.svg" alt="博客图标" style="width: 20px; height: 20px; margin-right: 10px;">
                            <span>博客</span>
                        </a>
                    </div>
                    <div class="col-4 mb-3">
                        <a href="#" class="btn w-100 shadow d-flex align-items-center justify-content-center"
                            style="background: rgba(50, 50, 50, 0.8); height: 60px; font-size: 16px; color: white; font-family: 'Microsoft YaHei', sans-serif;">
                            <img src="./images/音乐.svg" alt="音乐图标" style="width: 20px; height: 20px; margin-right: 10px;">
                            <span>音乐</span>
                        </a>
                    </div>
                    <div class="col-4 mb-3">
                        <a href="#" class="btn w-100 shadow d-flex align-items-center justify-content-center"
                            style="background: rgba(50, 50, 50, 0.8); height: 60px; font-size: 16px; color: white; font-family: 'Microsoft YaHei', sans-serif;">
                            <img src="./images/搜索 (1).svg" alt="搜索图标" style="width: 20px; height: 20px; margin-right: 10px;">
                            <span>搜索</span>
                        </a>
                    </div>
                </div>
                
                <!-- 更新日志 -->
                <div class="card w-100 mt-3"
                    style="background: rgba(50, 50, 50, 0.8); backdrop-filter: blur(10px); color: white; font-family: 'Microsoft YaHei', sans-serif;">
                    <div class="card-body" style="padding: 12px;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="card-title mb-0" style="font-size: 1rem; font-weight: bold; color: rgba(255, 255, 255, 0.9);">更新日志</h6>
                        </div>
                        <div class="update-log" id="update-log-short">
                            <!-- 动态插入简要日志 -->
                        </div>
                        <div class="mt-2">
                            <button id="showAllUpdates" class="btn w-100" style="background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 6px 12px; font-size: 0.8rem; border-radius: 8px; transition: all 0.3s ease;">
                                查看更多...
                            </button>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </main>

    <!-- 更新日志模态框 -->
    <div id="updateModal" class="modal fade" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
            <div class="modal-content" style="background: rgba(50, 50, 50, 0.95); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-family: 'Microsoft YaHei', sans-serif;">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
                    <h5 class="modal-title" id="updateModalLabel" style="font-size: 1.2rem; font-weight: bold;">更新日志</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                    <div class="update-log-full" id="update-log-full">
                        <!-- 动态插入完整日志 -->
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- 底部版权 -->
    <footer class="footer-fixed" style="text-align: center; color: white; font-size: 0.9rem; position: fixed; bottom: 0; left: 0; right: 0; padding: 10px 0;">
        <div style="display: inline-block; background: linear-gradient(135deg, rgba(128, 128, 128, 0.8), rgba(64, 64, 64, 0.8)); padding: 8px 20px; border-radius: 20px; backdrop-filter: blur(5px);">
            &copy; 2025 版权所有. @王映寒
        </div>
    </footer>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function updateTime() {
            const now = new Date();
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('date').textContent = now.toLocaleDateString('zh-CN', dateOptions);
            document.getElementById('time').textContent = now.toLocaleTimeString('zh-CN', timeOptions);
        }

        // 动态天气（高德地图API + 备用方案）
        async function updateWeather() {
            const key = '7e4f726be1be9def9aae111e9bb2aa72'; // 服务端API Key
            let city = '北京'; // 默认城市
            let latitude, longitude;
            
            try {
                // 首先尝试获取GPS位置（移动端优先）
                if (navigator.geolocation) {
                    try {
                        const position = await getCurrentPosition();
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                        console.log('GPS位置获取成功:', { latitude, longitude });
                        
                        // 使用GPS坐标通过高德地图API获取城市信息
                        const locationRes = await fetch(`https://restapi.amap.com/v3/geocode/regeo?key=${key}&location=${longitude},${latitude}&output=json`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                            },
                            timeout: 5000
                        });
                        
                        if (locationRes.ok) {
                            const locationData = await locationRes.json();
                            console.log('GPS定位结果:', locationData);
                            
                            if (locationData.status === '1' && locationData.regeocode && locationData.regeocode.addressComponent) {
                                const addressComponent = locationData.regeocode.addressComponent;
                                city = addressComponent.city || addressComponent.district || addressComponent.province;
                                city = city.replace(/市|区|省/g, ''); // 去掉行政区划后缀
                                console.log('GPS定位城市:', city);
                            }
                        }
                    } catch (gpsError) {
                        console.log('GPS定位失败，尝试IP定位:', gpsError);
                    }
                }
                
                // 如果GPS定位失败，尝试通过IP获取用户位置
                if (!city || city === '北京') {
                    try {
                        const ipRes = await fetch(`https://restapi.amap.com/v3/ip?key=${key}`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                            },
                            timeout: 5000 // 5秒超时
                        });
                        
                        if (ipRes.ok) {
                            const ipData = await ipRes.json();
                            console.log('IP定位结果:', ipData);
                            
                            if (ipData.status === '1' && ipData.city && ipData.city !== '[]') {
                                city = ipData.city.replace(/市/g, ''); // 去掉"市"字
                            }
                        }
                    } catch (ipError) {
                        console.log('IP定位失败，使用默认城市:', ipError);
                    }
                }
                
                // 使用高德地图天气API获取实时天气
                const weatherRes = await fetch(`https://restapi.amap.com/v3/weather/weatherInfo?key=${key}&city=${city}&extensions=base`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    timeout: 5000 // 5秒超时
                });
                
                if (weatherRes.ok) {
                    const weatherData = await weatherRes.json();
                    console.log('天气查询结果:', weatherData);
                    
                    if (weatherData.status === '1' && weatherData.lives && weatherData.lives.length > 0) {
                        const weather = weatherData.lives[0];
                        const weatherText = weather.weather;
                        const temperature = weather.temperature;
                        document.getElementById('weather').textContent = `${city} ${weatherText} ${temperature}°C`;
                        return; // 成功获取，直接返回
                    }
                }
                
                // 如果高德API失败，尝试备用天气API
                throw new Error('高德天气API失败，尝试备用方案');
                
            } catch (error) {
                console.error('高德天气API失败:', error);
                
                // 备用方案：使用wttr.in API
                try {
                    const fallbackRes = await fetch(`https://wttr.in/${city}?format=j1`, {
                        method: 'GET',
                        timeout: 5000
                    });
                    
                    if (fallbackRes.ok) {
                        const fallbackData = await fallbackRes.json();
                        console.log('备用天气API结果:', fallbackData);
                        
                        if (fallbackData.current_condition && fallbackData.current_condition.length > 0) {
                            const current = fallbackData.current_condition[0];
                            const weatherText = current.lang_zh ? current.lang_zh[0].value : current.weatherDesc[0].value;
                            const temperature = current.temp_C;
                            document.getElementById('weather').textContent = `${city} ${weatherText} ${temperature}°C`;
                            return;
                        }
                    }
                } catch (fallbackError) {
                    console.error('备用天气API也失败:', fallbackError);
                }
                
                // 所有方案都失败，显示默认信息
                document.getElementById('weather').textContent = `${city} 天气信息暂时无法获取`;
            }
        }

        // 更新日志动态渲染
        function renderUpdateLog() {
            fetch('./update-log.json')
                .then(res => {
                    if (!res.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return res.json();
                })
                .then(list => {
                    // 使用 DocumentFragment 优化DOM操作
                    const shortFragment = document.createDocumentFragment();
                    const fullFragment = document.createDocumentFragment();
                    
                    // 简要日志（只显示前2条）
                    list.slice(0,2).forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'update-item mb-1';
                        div.style.cssText = 'border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 4px;';
                        div.innerHTML = `
                            <div class="d-flex justify-content-between align-items-start">
                                <span class="update-title" style="font-size: 0.8rem; color: rgba(255,255,255,0.7);">${item.title}</span>
                                <span class="update-time" style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">${item.date}</span>
                            </div>
                        `;
                        shortFragment.appendChild(div);
                    });
                    
                    // 完整日志
                    list.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'update-item-full mb-3';
                        div.style.cssText = 'border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 12px;';
                        div.innerHTML = `
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <span class="update-title-full" style="font-size: 1rem; font-weight: bold; color: rgba(255,255,255,0.9);">${item.title}</span>
                                <span class="update-time-full" style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">${item.date}</span>
                            </div>
                            <p class="update-desc" style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin: 0;">${item.desc}</p>
                        `;
                        fullFragment.appendChild(div);
                    });
                    
                    // 一次性更新DOM
                    const shortContainer = document.getElementById('update-log-short');
                    const fullContainer = document.getElementById('update-log-full');
                    
                    shortContainer.innerHTML = '';
                    fullContainer.innerHTML = '';
                    
                    shortContainer.appendChild(shortFragment);
                    fullContainer.appendChild(fullFragment);
                })
                .catch(error => {
                    console.error('加载更新日志失败:', error);
                    document.getElementById('update-log-short').innerHTML = '<div style="color: rgba(255,255,255,0.6); font-size: 0.8rem;">无法加载更新日志</div>';
                    document.getElementById('update-log-full').innerHTML = '<div style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">无法加载更新日志</div>';
                });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 使用 requestAnimationFrame 优化时间更新
            function updateTimeWithRAF() {
                updateTime();
                requestAnimationFrame(updateTimeWithRAF);
            }
            
            // 启动时间更新（每秒更新一次）
            let lastUpdate = 0;
            function animateTime(currentTime) {
                if (currentTime - lastUpdate >= 1000) {
                    updateTime();
                    lastUpdate = currentTime;
                }
                requestAnimationFrame(animateTime);
            }
            requestAnimationFrame(animateTime);
            
            // 初始化其他功能
            updateTime();
            
            // 检查位置权限并获取天气
            checkLocationPermission();
            
            renderUpdateLog();
            
            // 更新日志模态框功能
            document.getElementById('showAllUpdates').addEventListener('click', function() {
                // 预加载模态框内容，避免打开时卡顿
                const modalElement = document.getElementById('updateModal');
                if (!modalElement.classList.contains('modal-loaded')) {
                    modalElement.classList.add('modal-loaded');
                }
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            });
            
            // 邮箱按钮点击事件
            document.getElementById('emailBtn').addEventListener('click', function(e) {
                e.preventDefault();
                copyToClipboard('nufewyh2023@163.com');
                showContactInfo('邮箱：nufewyh2023@163.com');
            });
            
            // 微信按钮点击事件
            document.getElementById('wechatBtn').addEventListener('click', function(e) {
                e.preventDefault();
                copyToClipboard('Gatsby933');
                showContactInfo('微信：Gatsby933');
            });
        });
        
        // 复制到剪贴板功能
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                // 使用现代 Clipboard API
                navigator.clipboard.writeText(text).then(function() {
                    showCopySuccess();
                }).catch(function(err) {
                    console.error('复制失败:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                // 降级方案
                fallbackCopyTextToClipboard(text);
            }
        }
        
        // 降级复制方案
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess();
                } else {
                    alert('复制失败，请手动复制：' + text);
                }
            } catch (err) {
                console.error('复制失败:', err);
                alert('复制失败，请手动复制：' + text);
            }
            
            document.body.removeChild(textArea);
        }
        
        // 显示复制成功提示
        function showCopySuccess() {
            // 创建临时提示元素
            const toast = document.createElement('div');
            toast.style.cssText = 'position: fixed; top: 20px; right: 20px; background: rgba(76, 175, 80, 0.9); color: white; padding: 12px 20px; border-radius: 8px; font-size: 14px; z-index: 9999;';
            toast.textContent = '复制成功！';
            document.body.appendChild(toast);
            
            // 3秒后自动移除
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 2000);
        }
        
        // 检查位置权限并获取天气
        async function checkLocationPermission() {
            // 检查是否支持地理定位
            if (!navigator.geolocation) {
                console.log('浏览器不支持地理定位，使用IP定位');
                updateWeather();
                return;
            }
            
            // 检查权限状态（如果支持）
            if (navigator.permissions && navigator.permissions.query) {
                try {
                    const permission = await navigator.permissions.query({ name: 'geolocation' });
                    
                    if (permission.state === 'granted') {
                        // 已授权，直接获取位置
                        console.log('位置权限已授权');
                        updateWeather();
                    } else if (permission.state === 'prompt') {
                        // 需要请求权限
                        console.log('需要请求位置权限');
                        showLocationPermissionPrompt();
                    } else if (permission.state === 'denied') {
                        // 权限被拒绝
                        console.log('位置权限被拒绝，使用IP定位');
                        updateWeather();
                    }
                } catch (error) {
                    console.log('权限检查失败，尝试直接获取位置:', error);
                    updateWeather();
                }
            } else {
                // 不支持权限API，直接尝试获取位置
                console.log('不支持权限API，直接尝试获取位置');
                updateWeather();
            }
        }
        
        // 显示位置权限请求提示
        function showLocationPermissionPrompt() {
            const promptDiv = document.createElement('div');
            promptDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(50, 50, 50, 0.95);
                color: white;
                padding: 20px;
                border-radius: 12px;
                font-size: 14px;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                font-family: "Microsoft YaHei", sans-serif;
                text-align: center;
                max-width: 280px;
                min-width: 250px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            `;
            promptDiv.innerHTML = `
                <div style="margin-bottom: 18px;">
                    <h4 style="margin-bottom: 12px; font-size: 16px; font-weight: 600;">📍 获取位置信息</h4>
                    <p style="margin-bottom: 18px; line-height: 1.4; font-size: 13px; color: rgba(255, 255, 255, 0.9);">为了为您提供准确的天气信息，需要获取您的位置权限。</p>
                </div>
                <div style="display: flex; gap: 8px; justify-content: center;">
                    <button id="allowLocation" style="background: rgba(76, 175, 80, 0.8); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; min-width: 60px; white-space: nowrap;">允许</button>
                    <button id="denyLocation" style="background: rgba(158, 158, 158, 0.8); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; min-width: 60px; white-space: nowrap;">拒绝</button>
                </div>
            `;
            document.body.appendChild(promptDiv);
            
            // 绑定按钮事件
            document.getElementById('allowLocation').addEventListener('click', function() {
                document.body.removeChild(promptDiv);
                updateWeather();
            });
            
            document.getElementById('denyLocation').addEventListener('click', function() {
                document.body.removeChild(promptDiv);
                updateWeather();
            });
        }
        
        // GPS定位Promise包装
        function getCurrentPosition() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('浏览器不支持地理定位'));
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve(position);
                    },
                    (error) => {
                        let errorMessage = '获取位置失败';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = '用户拒绝了位置请求';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = '位置信息不可用';
                                break;
                            case error.TIMEOUT:
                                errorMessage = '获取位置超时';
                                break;
                            default:
                                errorMessage = '未知错误';
                                break;
                        }
                        reject(new Error(errorMessage));
                    },
                    {
                        enableHighAccuracy: true, // 高精度
                        timeout: 10000, // 10秒超时
                        maximumAge: 60000 // 缓存1分钟
                    }
                );
            });
        }
        
        // 显示联系信息
        function showContactInfo(text) {
            // 创建联系信息提示元素
            const contactToast = document.createElement('div');
            contactToast.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(50, 50, 50, 0.95); color: white; padding: 15px 25px; border-radius: 10px; font-size: 16px; z-index: 9999; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); font-family: "Microsoft YaHei", sans-serif;';
            contactToast.textContent = text;
            document.body.appendChild(contactToast);
            
            // 2秒后自动移除
            setTimeout(() => {
                if (document.body.contains(contactToast)) {
                    contactToast.style.opacity = '0';
                    contactToast.style.transform = 'translateX(-50%) translateY(-20px)';
                    contactToast.style.transition = 'all 0.3s ease';
                    setTimeout(() => {
                        if (document.body.contains(contactToast)) {
                            document.body.removeChild(contactToast);
                        }
                    }, 300);
                }
            }, 2000);
        }
    </script>
</body>

</html>